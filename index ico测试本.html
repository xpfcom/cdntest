<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>iTxGo🍃 - 智能路由</title>
<style>
body{margin:0;background:#f3f4f6;display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
.segments{display:flex;gap:10px;transition:transform .6s cubic-bezier(.22,1,.36,1),opacity .6s linear .1s,filter .6s ease;margin-bottom:30px}
.segments.fade-out,.fade-out{opacity:0;transition:opacity .6s ease}
.segments.fade-out{transform:scale(1.8);filter:blur(8px)}
.segment{width:28px;height:16px;border-radius:4px;animation:light 1s infinite ease-in-out}
.segment:nth-child(1){background:#6366f1}
.segment:nth-child(2){background:#ec4899;animation-delay:.2s}
.segment:nth-child(3){background:#0ea5e9;animation-delay:.4s}
.segment:nth-child(4){background:#10b981;animation-delay:.6s}
.segment:nth-child(5){background:#f59e0b;animation-delay:.8s}
@keyframes light{0%,100%{opacity:.4}50%{opacity:1}}
.text-common{margin:0;text-align:center;margin-bottom:15px}
.status{color:#64748b;max-width:80%;line-height:1.5;font-size:14px;min-height:21px}
.status.error{color:#ef4444}
.results{font-size:12px;color:#94a3b8;line-height:1.4;min-height:17px}
.retry-btn{margin:0;padding:8px 16px;background:#e2e8f0;border:none;border-radius:6px;color:#334155;cursor:pointer;transition:background .2s;font-size:14px;display:none}
.retry-btn:hover{background:#cbd5e1}
</style>
</head>
<body>
<div class="segments" id="l">
<div class="segment"></div>
<div class="segment"></div>
<div class="segment"></div>
<div class="segment"></div>
<div class="segment"></div>
</div>
<div class="status text-common" id="s">正在检测最优服务器...</div>
<div class="results text-common" id="r"></div>
<button class="retry-btn" id="b">重新检测</button>
<script>
const S=[
{url:'https://381661.xyz',name:'CloudFlare 节点'},
{url:'https://itxgo.com',name:'Vercel 节点'},
{url:'https://wllgo.com',name:'Netlify 节点'}
],e={l:document.getElementById('l'),s:document.getElementById('s'),r:document.getElementById('r'),b:document.getElementById('b')};
let d=false;

async function test(s){
const t=performance.now();
return new Promise(r=>{
const i=new Image(),timer=setTimeout(()=>r({...s,ok:false,time:Infinity}),3000);
const f=ok=>{
clearTimeout(timer);
const time=performance.now()-t;
console.log(`${s.name}: ${ok?'成功':'失败'} ${time.toFixed(0)}ms`);
r({...s,ok,time});
};
i.onload=()=>f(true);i.onerror=()=>f(false);
i.src=`${s.url}/favicon.svg/favicon.svg?t=${Date.now()}&r=${Math.random()}`;
});
}

function update(status,results='',error=false){
e.s.textContent=status;
e.s.className=error?'status text-common error':'status text-common';
e.r.textContent=results;
e.r.style.display=results?'block':'none';
}

async function detect(){
if(d)return;
d=true;
e.b.style.display='none';
e.l.classList.remove('fade-out');

update('正在检测最优服务器...',S.map(s=>s.name).join(' | '));

try{
console.log('开始检测...');
const results=await Promise.all(S.map(test));
console.table(results);

const available=results.filter(r=>r.ok);
if(!available.length)throw new Error('所有服务器均不可用');

available.sort((a,b)=>a.time-b.time);
const best=available[0];
const resultText=available.slice(0,3).map(r=>`${r.name}: ${r.time.toFixed(0)}ms`).join(' | ');

update(`检测完成，最优服务器: ${best.name} (${best.time.toFixed(0)}ms)`,resultText);
console.log('跳转到:',best.url);

setTimeout(()=>{
update(`即将跳转到 ${best.name}...`,resultText);
setTimeout(()=>{
e.l.classList.add('fade-out');
e.s.classList.add('fade-out');
e.r.classList.add('fade-out');
setTimeout(()=>window.location.href=best.url,700);
},500);
},1000);

}catch(error){
console.error('检测失败:',error);
update(error.message,'',true);
e.b.style.display='block';
}finally{
d=false;
}
}

e.b.onclick=detect;
detect();
</script>
</body>
</html>