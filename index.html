<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>最优路径选择</title>
    <script>
        // 要测试的URL列表
        const targetUrls = [
            'https://www.toutiao.com',
            'https://www.163.com',
            'https://itxgo.xyz'
        ];
        
        // 存储延迟结果的数组
        let latencyResults = [];
        
        // 测量单个URL的延迟
        async function measureLatency(url) {
            const startTime = performance.now();
            try {
                // 使用fetch API测量延迟
                // 注意: 这里使用HEAD方法只获取头部信息，减少数据传输量
                const response = await fetch(url, {
                    method: 'HEAD',
                    mode: 'no-cors', // 避免CORS问题
                    cache: 'no-store' // 避免缓存影响
                });
                const endTime = performance.now();
                return {
                    url,
                    latency: endTime - startTime,
                    status: 'success'
                };
            } catch (error) {
                return {
                    url,
                    latency: Infinity, // 如果出错，设置为无限大延迟
                    status: 'error'
                };
            }
        }
        
        // 测量所有URL的延迟
        async function measureAllLatencies() {
            const measurements = await Promise.all(targetUrls.map(measureLatency));
            
            // 过滤掉失败的测量
            const validResults = measurements.filter(result => result.status === 'success');
            
            if (validResults.length === 0) {
                // 如果所有测量都失败，默认跳转到第一个URL
                window.location.href = targetUrls[0];
                return;
            }
            
            // 按延迟排序
            validResults.sort((a, b) => a.latency - b.latency);
            
            // 存储结果供后续使用
            latencyResults = validResults;
            
            // 跳转到延迟最低的URL
            window.location.href = validResults[0].url;
        }
        
        // 页面加载后开始测量
        window.addEventListener('DOMContentLoaded', measureAllLatencies);
    </script>
    <style>
        /* 添加一个加载动画让用户知道正在检测最佳路径 */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(255, 255, 255, 0.9);
            z-index: 1000;
        }
        
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- 加载动画 -->
    <div class="loader">
        <div class="spinner"></div>
        <p>正在检测最佳访问路径...</p>
    </div>
</body>
</html>
