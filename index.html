<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>iTxGoğŸƒ - æ™ºèƒ½è·¯ç”±</title>
<style>
body{margin:0;background:#f3f4f6;display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
.segments{display:flex;gap:10px;transition:transform .6s cubic-bezier(.22,1,.36,1),opacity .6s linear .1s,filter .6s ease;margin-bottom:30px}
.segments.fade-out,.fade-out{opacity:0;transition:opacity .6s ease}
.segments.fade-out{transform:scale(1.8);filter:blur(8px)}
.segment{width:28px;height:16px;border-radius:4px;animation:light 1s infinite ease-in-out}
.segment:nth-child(1){background:#6366f1}
.segment:nth-child(2){background:#ec4899;animation-delay:.2s}
.segment:nth-child(3){background:#0ea5e9;animation-delay:.4s}
.segment:nth-child(4){background:#10b981;animation-delay:.6s}
.segment:nth-child(5){background:#f59e0b;animation-delay:.8s}
@keyframes light{0%,100%{opacity:.4}50%{opacity:1}}
.text-common{margin:0;text-align:center;margin-bottom:15px}
.status{color:#64748b;max-width:80%;line-height:1.5;font-size:14px;min-height:21px}
.status.error{color:#ef4444}
.results{font-size:12px;color:#94a3b8;line-height:1.4;min-height:17px}
.retry-btn{margin:0;padding:8px 16px;background:#e2e8f0;border:none;border-radius:6px;color:#334155;cursor:pointer;transition:background .2s;font-size:14px;display:none}
.retry-btn:hover{background:#cbd5e1}
</style>
</head>
<body>
<div class="segments" id="l">
<div class="segment"></div>
<div class="segment"></div>
<div class="segment"></div>
<div class="segment"></div>
<div class="segment"></div>
</div>
<div class="status text-common" id="s">æ­£åœ¨æ£€æµ‹æœ€ä¼˜æœåŠ¡å™¨...</div>
<div class="results text-common" id="r"></div>
<button class="retry-btn" id="b">é‡æ–°æ£€æµ‹</button>
<script>
const S=[
{url:'https://tc.itxgo.com',name:'EdgeOne èŠ‚ç‚¹'},
{url:'https://vc.itxgo.com',name:'Vercel èŠ‚ç‚¹'},
{url:'https://nl.itxgo.com',name:'Netlify èŠ‚ç‚¹'}
],e={l:document.getElementById('l'),s:document.getElementById('s'),r:document.getElementById('r'),b:document.getElementById('b')};
let d=false;

async function test(s){
    const t=performance.now();
    try{
        const controller=new AbortController();
        const timer=setTimeout(()=>controller.abort(),3000);
        const response=await fetch(`${s.url}/?t=${Date.now()}&r=${Math.random()}`,{
            method:'HEAD',
            mode:'no-cors',
            cache:'no-cache',
            signal:controller.signal
        });
        clearTimeout(timer);
        const time=performance.now()-t;
        console.log(`${s.name}: æˆåŠŸ ${time.toFixed(0)}ms`);
        return{...s,ok:true,time};
    }catch(error){
        const time=performance.now()-t;
        console.log(`${s.name}: å¤±è´¥ ${time.toFixed(0)}ms - ${error.message}`);
        return{...s,ok:false,time:Infinity};
    }
}

function update(status,results='',error=false){
    e.s.textContent=status;
    e.s.className=error?'status text-common error':'status text-common';
    e.r.textContent=results;
    e.r.style.display=results?'block':'none';
}

async function detect(){
    if(d)return;
    d=true;
    e.b.style.display='none';
    e.l.classList.remove('fade-out');

    update('æ­£åœ¨æ£€æµ‹æœ€ä¼˜æœåŠ¡å™¨...',S.map(s=>s.name).join(' | '));

    try{
        console.log('å¼€å§‹æ£€æµ‹...');
        const results=await Promise.all(S.map(test));
        console.table(results);

        // æ˜¾ç¤ºæ‰€æœ‰èŠ‚ç‚¹æµ‹é€Ÿç»“æœ
        const resultText = results.map(r =>
            `${r.name}: ${r.ok ? `${r.time.toFixed(0)}ms` : 'å¤±è´¥'}`
        ).join(' | ');

        // ä»å¯ç”¨èŠ‚ç‚¹ä¸­é€‰æ‹©æœ€ä¼˜
        const available = results.filter(r => r.ok);
        if(!available.length) throw new Error('æ‰€æœ‰æœåŠ¡å™¨å‡ä¸å¯ç”¨');

        available.sort((a,b)=>a.time-b.time);
        const best = available[0];

        update(`æ£€æµ‹å®Œæˆï¼Œæœ€ä¼˜æœåŠ¡å™¨: ${best.name} (${best.time.toFixed(0)}ms)`, resultText);
        console.log('è·³è½¬åˆ°:', best.url);

        setTimeout(()=>{
            update(`å³å°†è·³è½¬åˆ° ${best.name}...`, resultText);
            setTimeout(()=>{
                e.l.classList.add('fade-out');
                e.s.classList.add('fade-out');
                e.r.classList.add('fade-out');
                setTimeout(()=>window.location.href=best.url,700);
            },500);
        },1000);

    }catch(error){
        console.error('æ£€æµ‹å¤±è´¥:',error);
        update(error.message,'',true);
        e.b.style.display='block';
    }finally{
        d=false;
    }
}

e.b.onclick=detect;
detect();
</script>
</body>
</html>
